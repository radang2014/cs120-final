<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exercise Matching App</title>
  <link rel="stylesheet" href="/style/style.css">
  <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   
	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   
	crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANyn8_H3J81QDHaEmE7DfhyhXZWLol1xU&libraries=places"></script>
</head>
<body>
    <ul class="nav_bar">
        <li style="float:left;">Exercise Matching App</li>
        <a href="/login"><li style="float:right;">Login</li></a>
    </ul>

    <form name="create_event" method="get" action="process_create_event">        

      <div id="meta_form_section">
        <div>
            Event Description: <input type="text" name="description" />
        </div>

        <div>
          Start Time: <input type="datetime-local" id="event_date" name="event_date" />
        </div>

        <div>
          Max Attendees: <input type="number" name="max" step="1" min="2" max="100" pattern="[0-9]"/>
        </div>

        <div style="visibility:hidden;">
          <input type="text" name="exercise_list" id="form_exercise_list"/>
        </div>

        <div style="visibility:hidden;">
          <input type="text" name="tags" id="tags"/>
        </div>

        <label><b>Location:</b></label><br>
        <input style="width:500px;" type="text" id="autocomplete" placeholder="Enter a location" autocomplete="off" name="location" />

        <input type="submit" value="Create New Event" />
    </div>
    
  </form>

  <div id="activies">
    Activites in event:
  </div>

  <div id="exercise_list">
    <div>
      <form id="tag_search_form">
        Activity Type: <input id="searchTag" type="text" name="tag" />
        <input type="submit" value="->" />
      </form>
      
      <div id="activity_suggestions">
        Activity Suggestions
        &nbsp;
      </div>
    </div>
  </div>

  <script>

    var exercise_list = [];
    var tags = [];

    $('#tag_search_form').submit(function(evt) {
      evt.preventDefault();
      const form = evt.target;
      var type = form.elements['searchTag'].value

      var NINJA_KEY = 'qeNhjH2hMUdhL/j5q7VefQ==Gli1rR8gy8d0xXxZ';
      var apiUrl = `https://api.api-ninjas.com/v1/exercises?type=${type}&X-Api-Key=${NINJA_KEY}`
      fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        activities = 'Suggested Activites';
        data.forEach(function(exercise) {
          let name = exercise.name
          let type = exercise.type
          let level = exercise.difficulty
          activities += `<div class='activitySuggestion' id='${name}' tagtype='${type}'>${name}<br>Type: ${type}<br>Difficulty: ${level}</div>`
        })
        $('#activity_suggestions').html(activities)
        $( ".activitySuggestion" ).on( "click", function() {
          $(this).attr("class", "activityEntered")
          exercise_list.push($(this));          
          $(this).fadeOut(100);
          updateExerciseList()
        } );
       
      
      })
      .catch(error => {
        console.error('Error:', error);
      })
    })

    updateExerciseList = function() {
      let exercise_names = []
      let tags = []
      activities = 'Activities in Event:<br>'
      exercise_list.forEach(function(exercise){          
        var tagtype = exercise.attr('tagtype')
        activities += `<div class='activityEntered' id='${exercise[0].id}' tagtype='${tagtype}'>${exercise[0].innerHTML}</div>`
        
        exercise_names.push(exercise[0].id)
        if (!tags.includes(tagtype)){
          tags.push(tagtype)
        }
        
      })
      $('#activies').html(activities)

      $( ".activityEntered" ).on( "click", function() {
        //var drop_ind = exercise_list.find(x => x.id === $(this).id)
        console.log($(this)[0].id)
        

        exercise_list = exercise_list.filter(item => item[0].id !== $(this)[0].id)
        console.log(exercise_list)

        $(this).fadeOut(100);
        updateExerciseList()
      } );

      $('#form_exercise_list').val(exercise_names.toString())
      $('#tags').val(tags.toString())
    }

        // Initialize Google Places Autocomplete
        
        const autocompleteInput = document.getElementById('autocomplete');
        const autocomplete = new google.maps.places.Autocomplete(autocompleteInput);
        
        // Add event listener for form submission
        /*
        document.getElementById('placeForm').addEventListener('submit', function(event) {
          event.preventDefault();
          const place = autocomplete.getPlace();
          if (place.geometry) {
            const placeDetailsDiv = document.getElementById('placeDetails');
            placeDetailsDiv.innerHTML = `
              <p><strong>Name:</strong> ${place.name}</p>
              <p><strong>Address:</strong> ${place.formatted_address}</p>
              <p><strong>Coordinates:</strong> ${place.geometry.location.lat()}, ${place.geometry.location.lng()}</p>
            `;
          } else {
            alert('Please select a location from the autocomplete suggestions.');
          }
        });
        
        */

  </script>

</body>
</html>