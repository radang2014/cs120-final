<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exercise Matching App</title>
  <link rel="stylesheet" href="/style/new_event_style.css">

  <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   
	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   
	crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANyn8_H3J81QDHaEmE7DfhyhXZWLol1xU&libraries=places"></script>
</head>
<body>
      <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/login">Login</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a href="/new_event">Create New Events</a></li>
            <li><a href="/browse_event">Browse Events</a></li>
        </ul>
    </nav>


    <div class="MainContainer">
      <div class="BackgroundImage"></div>
      <div class="InfoContainer">
        <p class="MainTitle">
          Start an adventure with
        </p>
        <p class="gradient-text">
          Someone New.
        </p>

        <p class="SectionTitle">
          Check us out!
        </p>
        <hr class="line">

        <div id="adverts"></div>

        <p class="SectionTitle">
          About your Event
        </p>
        <hr class="line">

        <form name="create_event" method="get" action="process_create_event">        

          <div id="meta_form_section">
            <div>
                Event Description: <input type="text" name="description" />
            </div>

            <div>
              Start Time: <input required type="datetime-local" id="event_date" name="event_date" />
            </div>

            <div>
              Max Attendees: <input required type="number" name="max" step="1" min="2" max="100" pattern="[0-9]"/>
            </div>

            <div>
              Location: <input required style="width:200px;" type="text" id="autocomplete" placeholder="Enter a location" autocomplete="off" name="location" />
            </div>

            <div style="visibility:hidden;">
              <input type="text" name="exercise_list" id="form_exercise_list"/>
            </div>

            <div style="visibility:hidden;">
              <input type="text" name="tags" id="tags"/>
            </div>

            <input type="submit" value="Create New Event" />

          </div>
        </form>

        <div id="activies">
          Activites in event:
        </div>

        <div id="suggestion_wrapper">
          <div>
            <form id="tag_search_form">
              Activity Type: <input id="searchTag" type="text" name="tag" list="searchTagList"/><br>
              <datalist id="searchTagList">          
                <option value="cardio">cardio</option>
                <option value="olympic_weightlifting">olympic_weightlifting</option>
                <option value="plyometrics">plyometrics</option>
                <option value="powerlifting">powerlifting</option>
                <option value="strength">strength</option>
                <option value="stretching">stretching</option>
                <option value="strongman">strongman</option>
              </datalist>

              Muscle: <input id="searchMuscle" type="text" name="muscle" list="muscleList" /><br>
              <datalist id="muscleList">        
                <option value="abdominals">abdominals</option>
                <option value="abductors">abductors</option>
                <option value="adductors">adductors</option>
                <option value="biceps">biceps</option>
                <option value="calves">calves</option>
                <option value="chest">chest</option>
                <option value="forearms">forearms</option>
                <option value="glutes">glutes</option>
                <option value="hamstrings">hamstrings</option>
                <option value="lats">lats</option>
                <option value="lower_back">lower_back</option>
                <option value="middle_back">middle_back</option>
                <option value="neck">neck</option>
                <option value="quadriceps">quadriceps</option>
                <option value="traps">traps</option>
                <option value="triceps">triceps</option>
              </datalist>
              Difficulty: <input id="searchLevel" type="text" name="difficulty" list="levelList" />
              <datalist id="levelList">        
                <option value="beginner">beginner</option>
                <option value="intermediate">intermediate</option>
                <option value="expert">expert</option>
              </datalist>
              <input type="submit" value="->" />
            </form>
            
            <div id="activity_suggestions">
              Activity Suggestions
              &nbsp;
            </div>
          </div>
        </div>
      </div>
    </div>

  <script>

    var exercise_list = [];
    var tags = [];

    $('#tag_search_form').submit(function(evt) {
      evt.preventDefault();
      const form = evt.target;
      var type = form.elements['searchTag'].value
      var muscle = form.elements['searchMuscle'].value
      var difficulty = form.elements['searchLevel'].value

      var NINJA_KEY = 'qeNhjH2hMUdhL/j5q7VefQ==Gli1rR8gy8d0xXxZ';
      var apiUrl = `https://api.api-ninjas.com/v1/exercises?type=${type}&muscle=${muscle}&difficulty=${difficulty}&X-Api-Key=${NINJA_KEY}`
      
      fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        
        activities = 'Activity Suggestions';
        data.forEach(function(exercise) {
          let name = exercise.name
          let type = exercise.type
          let level = exercise.difficulty
          activities += `<div class='activitySuggestion' id='${name}' tagtype='${type}'>${name}<br>Type: ${type}<br>Difficulty: ${level}</div>`
        })
        $('#activity_suggestions').html(activities)
        $( ".activitySuggestion" ).on( "click", function() {
          $(this).attr("class", "activityEntered")
          exercise_list.push($(this));          
          $(this).fadeOut(100);
          updateExerciseList()
        } );
       
      
      })
      .catch(error => {
        console.error('Error:', error);
      })
    })

    updateExerciseList = function() {
      let exercise_names = []
      let tags = []
      activities = 'Activities in Event:<br>'
      exercise_list.forEach(function(exercise){          
        var tagtype = exercise.attr('tagtype')
        activities += `<div class='activityEntered' id='${exercise[0].id}' tagtype='${tagtype}'>${exercise[0].innerHTML}</div>`
        
        exercise_names.push(exercise[0].id)
        if (!tags.includes(tagtype)){
          tags.push(tagtype)
        }
        
      })
      $('#activies').html(activities)

      $( ".activityEntered" ).on( "click", function() {
        exercise_list = exercise_list.filter(item => item[0].id !== $(this)[0].id)
        $(this).fadeOut(100);
        updateExerciseList()
      } );

      $('#form_exercise_list').val(exercise_names.toString())
      $('#tags').val(tags.toString())
    }

        // Initialize Google Places Autocomplete
        
        const autocompleteInput = document.getElementById('autocomplete');
        const autocomplete = new google.maps.places.Autocomplete(autocompleteInput);
        

  </script>

</body>
</html>